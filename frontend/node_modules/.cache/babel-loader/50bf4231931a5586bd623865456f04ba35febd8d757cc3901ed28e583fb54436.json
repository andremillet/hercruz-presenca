{"ast":null,"code":"import React,{useState,useEffect}from'react';import QrReader from'react-qr-scanner';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=()=>{const[qrCodeUrl,setQrCodeUrl]=useState('');const[showModal,setShowModal]=useState(false);const[cpf,setCpf]=useState('');const[isNewUser,setIsNewUser]=useState(false);const[name,setName]=useState('');const[crm,setCrm]=useState('');const[message,setMessage]=useState('');useEffect(()=>{const urlParams=new URLSearchParams(window.location.search);const isScan=urlParams.get('scan')==='true';if(!isScan){const fetchQr=async()=>{try{console.log('Fetching QR from:',api.defaults.baseURL+'/qr/generate');const response=await api.get('/qr/generate',{responseType:'blob'});console.log('QR response:',response);const url=URL.createObjectURL(response.data);setQrCodeUrl(url);}catch(error){console.log('QR fetch error:',error);setMessage('Failed to generate QR code: '+error.message);}};fetchQr();}else{setShowModal(true);}},[]);const handleCpfSubmit=async e=>{e.preventDefault();try{const response=await api.post('/auth/validate_cpf',{cpf});if(response.data.exists){localStorage.setItem('user_id',response.data.user_id);window.location.href='/dashboard';// Redirect to check-ins page\n}else{setIsNewUser(true);}}catch(error){setMessage('CPF validation failed');}};const handleRegister=async e=>{e.preventDefault();try{const response=await api.post('/auth/register_cpf',{cpf,name,crm});localStorage.setItem('user_id',response.data.user_id);window.location.href='/dashboard';}catch(error){setMessage('Registration failed');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-100\",children:[!showModal&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded shadow-md text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl mb-4\",children:\"Confirme Presen\\xE7a\"}),qrCodeUrl&&/*#__PURE__*/_jsx(\"img\",{src:qrCodeUrl,alt:\"QR Code\",className:\"mx-auto mb-4 w-96 h-96\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-4\",children:\"Escanear com c\\xE2mera do celular para confirmar presen\\xE7a\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowModal(true);},className:\"w-full bg-gray-500 text-white p-2\",children:\"Simular Escanear (Teste)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4\",children:message})]}),showModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded shadow-md\",children:[!isNewUser?/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleCpfSubmit,children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl mb-4\",children:\"Digite seu CPF\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",placeholder:\"CPF\",value:cpf,onChange:e=>setCpf(e.target.value),className:\"w-full p-2 mb-4 border\",required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-green-500 text-white p-2\",children:\"Confirmar\"})]}):/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleRegister,children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl mb-4\",children:\"Cadastro\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Nome Completo\",value:name,onChange:e=>setName(e.target.value),className:\"w-full p-2 mb-4 border\",required:true}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"CRM\",value:crm,onChange:e=>setCrm(e.target.value),className:\"w-full p-2 mb-4 border\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-green-500 text-white p-2\",children:\"Registrar\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowModal(false),className:\"mt-4 text-red-500\",children:\"Fechar\"})]})})]});};export default Login;","map":{"version":3,"names":["React","useState","useEffect","QrReader","api","jsx","_jsx","jsxs","_jsxs","Login","qrCodeUrl","setQrCodeUrl","showModal","setShowModal","cpf","setCpf","isNewUser","setIsNewUser","name","setName","crm","setCrm","message","setMessage","urlParams","URLSearchParams","window","location","search","isScan","get","fetchQr","console","log","defaults","baseURL","response","responseType","url","URL","createObjectURL","data","error","handleCpfSubmit","e","preventDefault","post","exists","localStorage","setItem","user_id","href","handleRegister","className","children","src","alt","onClick","onSubmit","type","placeholder","value","onChange","target","required"],"sources":["/home/woulschneider/hercruz-presenca/frontend/src/components/Login.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport QrReader from 'react-qr-scanner';\nimport api from '../services/api';\n\nconst Login = () => {\n  const [qrCodeUrl, setQrCodeUrl] = useState('');\n  const [showModal, setShowModal] = useState(false);\n  const [cpf, setCpf] = useState('');\n  const [isNewUser, setIsNewUser] = useState(false);\n  const [name, setName] = useState('');\n  const [crm, setCrm] = useState('');\n  const [message, setMessage] = useState('');\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const isScan = urlParams.get('scan') === 'true';\n\n    if (!isScan) {\n      const fetchQr = async () => {\n        try {\n          console.log('Fetching QR from:', api.defaults.baseURL + '/qr/generate');\n          const response = await api.get('/qr/generate', { responseType: 'blob' });\n          console.log('QR response:', response);\n          const url = URL.createObjectURL(response.data);\n          setQrCodeUrl(url);\n        } catch (error) {\n          console.log('QR fetch error:', error);\n          setMessage('Failed to generate QR code: ' + error.message);\n        }\n      };\n      fetchQr();\n    } else {\n      setShowModal(true);\n    }\n  }, []);\n\n\n\n  const handleCpfSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      const response = await api.post('/auth/validate_cpf', { cpf });\n      if (response.data.exists) {\n        localStorage.setItem('user_id', response.data.user_id);\n        window.location.href = '/dashboard'; // Redirect to check-ins page\n      } else {\n        setIsNewUser(true);\n      }\n    } catch (error) {\n      setMessage('CPF validation failed');\n    }\n  };\n\n  const handleRegister = async (e) => {\n    e.preventDefault();\n    try {\n      const response = await api.post('/auth/register_cpf', { cpf, name, crm });\n      localStorage.setItem('user_id', response.data.user_id);\n      window.location.href = '/dashboard';\n    } catch (error) {\n      setMessage('Registration failed');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\n      {!showModal && (\n        <div className=\"bg-white p-6 rounded shadow-md text-center\">\n          <h2 className=\"text-2xl mb-4\">Confirme Presença</h2>\n          {qrCodeUrl && <img src={qrCodeUrl} alt=\"QR Code\" className=\"mx-auto mb-4 w-96 h-96\" />}\n          <p className=\"mb-4\">Escanear com câmera do celular para confirmar presença</p>\n          <button onClick={() => { setShowModal(true); }} className=\"w-full bg-gray-500 text-white p-2\">Simular Escanear (Teste)</button>\n          <p className=\"mt-4\">{message}</p>\n        </div>\n      )}\n\n      {showModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\n          <div className=\"bg-white p-6 rounded shadow-md\">\n            {!isNewUser ? (\n              <form onSubmit={handleCpfSubmit}>\n                <h3 className=\"text-xl mb-4\">Digite seu CPF</h3>\n                <input\n                  type=\"tel\"\n                  placeholder=\"CPF\"\n                  value={cpf}\n                  onChange={(e) => setCpf(e.target.value)}\n                  className=\"w-full p-2 mb-4 border\"\n                  required\n                />\n                <button type=\"submit\" className=\"w-full bg-green-500 text-white p-2\">Confirmar</button>\n              </form>\n            ) : (\n              <form onSubmit={handleRegister}>\n                <h3 className=\"text-xl mb-4\">Cadastro</h3>\n                <input\n                  type=\"text\"\n                  placeholder=\"Nome Completo\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full p-2 mb-4 border\"\n                  required\n                />\n                <input\n                  type=\"number\"\n                  placeholder=\"CRM\"\n                  value={crm}\n                  onChange={(e) => setCrm(e.target.value)}\n                  className=\"w-full p-2 mb-4 border\"\n                />\n                <button type=\"submit\" className=\"w-full bg-green-500 text-white p-2\">Registrar</button>\n              </form>\n            )}\n            <button onClick={() => setShowModal(false)} className=\"mt-4 text-red-500\">Fechar</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}